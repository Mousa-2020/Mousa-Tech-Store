<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø·Ù„Ø¨Ø§Øª - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | Mousa Tech Store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', sans-serif;
        }
        body {
            background: #f1f5f9;
            display: flex;
        }
        .sidebar {
            width: 250px;
            background: #0A0F1F;
            color: white;
            height: 100vh;
            position: fixed;
            padding: 20px 0;
        }
        .logo-area {
            padding: 0 20px 20px;
            border-bottom: 1px solid #334155;
        }
        .logo-area h2 {
            color: #F97316;
        }
        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #cbd5e1;
            cursor: pointer;
        }
        .menu-item:hover {
            background: #1e293b;
        }
        .menu-item.active {
            background: #F97316;
            color: white;
        }
        .main-content {
            margin-right: 250px;
            padding: 20px;
            width: calc(100% - 250px);
        }
        .filters-bar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
        }
        .search-box {
            flex: 1;
            display: flex;
            align-items: center;
            background: #f1f5f9;
            border-radius: 8px;
            padding: 0 15px;
        }
        .search-box input {
            border: none;
            background: none;
            padding: 12px;
            width: 100%;
            outline: none;
        }
        .filter-select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            min-width: 150px;
        }
        .orders-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
        }
        .order-card {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .order-id {
            font-weight: 700;
            color: #F97316;
        }
        .order-body {
            display: none;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        .order-body.show {
            display: grid;
        }
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        .status-new { background: #dbeafe; color: #1e40af; }
        .status-shipped { background: #fef3c7; color: #92400e; }
        .status-delivered { background: #d1fae5; color: #065f46; }
        .action-btn {
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            margin: 0 5px;
        }
        .action-btn:hover { color: #F97316; }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo-area">
            <h2>Mousa Tech</h2>
            <small>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</small>
        </div>
        <div class="menu-item" onclick="window.location.href='admin-dashboard.html'">ğŸ“Š Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <div class="menu-item" onclick="window.location.href='admin-products.html'">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
        <div class="menu-item active">ğŸ“‹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
        <div class="menu-item" onclick="window.location.href='admin-customers.html'">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
    </div>

    <div class="main-content">
        <div class="filters-bar">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Ø¨Ø­Ø«..." onkeyup="filterOrders()">
            </div>
            <select class="filter-select" id="statusFilter" onchange="filterOrders()">
                <option value="all">Ø§Ù„ÙƒÙ„</option>
                <option value="Ø¬Ø¯ÙŠØ¯">Ø¬Ø¯ÙŠØ¯</option>
                <option value="Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„">Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„</option>
                <option value="ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„">ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</option>
            </select>
        </div>

        <div class="orders-container" id="ordersContainer"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        let orders = [];

        async function loadOrders() {
            try {
                const snapshot = await db.collection('orders').orderBy('timestamp', 'desc').get();
                orders = [];
                snapshot.forEach(doc => orders.push({ id: doc.id, ...doc.data() }));
                
                if (orders.length === 0) {
                    orders = JSON.parse(localStorage.getItem('orders')) || [];
                }
                
                displayOrders(orders);
            } catch (error) {
                console.error('Ø®Ø·Ø£:', error);
                orders = JSON.parse(localStorage.getItem('orders')) || [];
                displayOrders(orders);
            }
        }

        function displayOrders(ordersToShow) {
            const container = document.getElementById('ordersContainer');
            
            if (ordersToShow.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:40px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</div>';
                return;
            }

            container.innerHTML = ordersToShow.map(order => {
                const statusClass = {
                    'Ø¬Ø¯ÙŠØ¯': 'status-new',
                    'Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„': 'status-shipped',
                    'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„': 'status-delivered'
                }[order.status] || 'status-new';

                return `
                    <div class="order-card">
                        <div class="order-header" onclick="toggleDetails('${order.id}')">
                            <div>
                                <span class="order-id">#${order.id}</span>
                                <span style="margin-right:10px;">${order.date}</span>
                            </div>
                            <span class="status-badge ${statusClass}">${order.status}</span>
                        </div>
                        <div class="order-body" id="details-${order.id}">
                            <div>
                                <strong>ğŸ‘¤ ${order.customer?.name}</strong><br>
                                ğŸ“ ${order.customer?.phone}<br>
                                ğŸ“ ${order.customer?.gov} - ${order.customer?.address}
                            </div>
                            <div>
                                <strong>ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</strong><br>
                                ${order.items?.map(i => `â€¢ ${i.name} - $${i.price}`).join('<br>')}
                            </div>
                            <div>
                                <strong>ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: $${order.total}</strong><br>
                                ğŸ’³ ${order.payment}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleDetails(id) {
            document.getElementById(`details-${id}`).classList.toggle('show');
        }

        function filterOrders() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const status = document.getElementById('statusFilter').value;

            let filtered = orders;

            if (search) {
                filtered = filtered.filter(o => 
                    o.customer?.name.toLowerCase().includes(search) ||
                    o.customer?.phone.includes(search)
                );
            }

            if (status !== 'all') {
                filtered = filtered.filter(o => o.status === status);
            }

            displayOrders(filtered);
        }

        loadOrders();
    </script>
</body>
</html>
